trigger:
- main

pool:
  name: local-linux

variables:
- group:  ghcr-secrets
- name: IMAGE_NAME
  value: ghcr.io/brucie83/container-health

steps:
- script: |
    echo "Login to GHCR"
    docker login ghcr.io -u "$(GHCR_USERNAME)" -p "$(GHCR_TOKEN)"
  displayName: "Docker login to GHCR"

- script: |
    echo "Build image"
    docker build \
      -f app/Dockerfile \
      -t $(IMAGE_NAME):$(Build.BuildId) \
      app
  displayName: "Docker build"

- script: |
    echo "Push image"
    docker push $(IMAGE_NAME):$(Build.BuildId)
  displayName: "Docker push"